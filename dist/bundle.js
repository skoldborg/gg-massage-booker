!function(e){function t(t){for(var r,i,u=t[0],s=t[1],c=t[2],f=0,p=[];f<u.length;f++)i=u[f],o[i]&&p.push(o[i][0]),o[i]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);for(l&&l(t);p.length;)p.shift()();return a.push.apply(a,c||[]),n()}function n(){for(var e,t=0;t<a.length;t++){for(var n=a[t],r=!0,u=1;u<n.length;u++){var s=n[u];0!==o[s]&&(r=!1)}r&&(a.splice(t--,1),e=i(i.s=n[0]))}return e}var r={},o={0:0},a=[];function i(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=e,i.c=r,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(n,r,function(t){return e[t]}.bind(null,r));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="";var u=window.webpackJsonp=window.webpackJsonp||[],s=u.push.bind(u);u.push=t,u=u.slice();for(var c=0;c<u.length;c++)t(u[c]);var l=s;a.push([140,1]),n()}({136:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();function o(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}}var a=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return r(e,[{key:"getRequest",value:function(){var e=o(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n?{Accept:"application/json",Authorization:"Bearer "+n}:{Accept:"application/json"},e.prev=1,e.next=4,fetch(t,{headers:r});case 4:if(!(o=e.sent).ok){e.next=11;break}return e.next=8,o.json();case 8:return e.abrupt("return",e.sent);case 11:return e.abrupt("return",o);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(1),e.t0;case 17:case"end":return e.stop()}},e,this,[[1,14]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"postRequest",value:function(){var e=o(regeneratorRuntime.mark(function e(t,n){var r,o,a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=arguments[3];return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=i?{"Content-Type":"application/json",Authorization:"Bearer "+i}:{"Content-Type":"application/json"},e.prev=1,e.next=4,fetch(t,{method:"POST",headers:r,body:JSON.stringify(n)});case 4:if(o=e.sent,!a){e.next=11;break}return e.next=8,o.json();case 8:return e.abrupt("return",e.sent);case 11:return e.abrupt("return",o);case 12:e.next=17;break;case 14:throw e.prev=14,e.t0=e.catch(1),e.t0;case 17:case"end":return e.stop()}},e,this,[[1,14]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"deleteRequest",value:function(){var e=o(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n?{Authorization:"Bearer "+n}:{},e.prev=1,e.next=4,fetch(t,{method:"DELETE",headers:r});case 4:return o=e.sent,e.next=7,o.text();case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,10]])}));return function(t,n){return e.apply(this,arguments)}}()},{key:"putRequest",value:function(){var e=o(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=n?{Authorization:"Bearer "+n}:{},e.prev=1,e.next=4,fetch(t,{method:"PUT",headers:r});case 4:return o=e.sent,e.next=7,o.json();case 7:return e.abrupt("return",e.sent);case 10:throw e.prev=10,e.t0=e.catch(1),e.t0;case 13:case"end":return e.stop()}},e,this,[[1,10]])}));return function(t,n){return e.apply(this,arguments)}}()}]),e}();t.default=new a},137:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=document.getElementById("app"),o=r?r.getAttribute("data-root-path"):"http://localhost:3001";t.default=o},140:function(e,t,n){n(100),e.exports=n(342)},342:function(e,t,n){"use strict";var r=n(362),o=n(8),a=n(346);!function(e){e&&e.__esModule}(n(361));(0,o.render)((0,o.h)(r.BrowserRouter,null,(0,o.h)("div",null,(0,o.h)(r.Route,{exact:!0,path:"/",component:a.Main}),(0,o.h)(r.Route,{path:"/admin",component:a.Admin}))),document.getElementById("app"))},346:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Admin=t.Main=void 0;var r=a(n(347)),o=a(n(360));function a(e){return e&&e.__esModule?e:{default:e}}t.Main=r.default,t.Admin=o.default},347:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(98);var o=n(8),a=n(99),i=s(n(136)),u=s(n(137));function s(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={accessToken:null,showSignInButton:!1},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"componentDidMount",value:function(){this.checkForAccessToken()}},{key:"checkForAccessToken",value:function(){var e=function(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}}(regeneratorRuntime.mark(function e(){var t,n,r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.default.getRequest(u.default+"/gettoken");case 2:if(t=e.sent,""===(n=t.token)||null===n){e.next=11;break}return e.next=7,i.default.getRequest("https://graph.microsoft.com/beta/me",n);case 7:r=e.sent,this.setState({accessToken:n,user:r}),e.next=12;break;case 11:this.setState({showSignInButton:!0});case 12:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){return(0,o.h)("div",{class:"main"},this.state.showSignInButton&&(0,o.h)("a",{href:"/signin",class:"button button--signin"},"Logga in för att boka en tid"),(0,o.h)("h2",{class:"main__subtitle"},"Tider"),(0,o.h)(a.TimeSlotsManager,{admin:!1,accessToken:this.state.accessToken,user:this.state.user}))}}]),t}();t.default=c},348:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(98),n(100);var o=n(8);var a=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"handleKeyDown",value:function(e,t){var n=e.target,r=this.props.user?this.props.user:null;13===e.which&&(r&&(n.value===r.mail&&n.parentNode.getAttribute(t)===t&&n.parentNode.classList.add("time-slot--taken"),e.target.blur()),this.props.updateTimeSlot(t,r))}},{key:"render",value:function(e){var t=this,n=e._id,r=e.name,a=e.dateFormatted,i=e.client,u=e.admin,s=e.user,c=void 0!==s?s.mail:"",l=""!==i?"time-slot--taken":"",f=void 0===s&&!u;return(0,o.h)("div",{id:n,class:"time-slot "+l},(0,o.h)("input",{style:""===i||u?"":"pointer-events: none; cursor:default;",class:"time-slot__input",type:"text",id:"input-"+a+"-"+r,value:i||c,onKeyDown:function(e){return t.handleKeyDown(e,n)},ref:function(e){t.input=e},disabled:f},(0,o.h)("div",null,i)),(0,o.h)("label",{style:""===i||u?"":"pointer-events: none; cursor:default;",class:"time-slot__label",for:"input-"+a+"-"+r},(0,o.h)("span",{class:"time-slot__label-content"},a," - ",r)),u&&""===i&&(0,o.h)("button",{class:"time-slot__remove-btn",onClick:function(){return t.props.removeTimeSlot(n)}}))}}]),t}();t.default=a},349:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(8),i=l(n(55)),u=n(99),s=l(n(136)),c=l(n(137));function l(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function r(o,a){try{var i=t[o](a),u=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(u).then(function(e){r("next",e)},function(e){r("throw",e)});e(u)}("next")})}}var p=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={timeSlots:[],timeSlotsUpdated:!1},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.Component),o(t,[{key:"componentDidMount",value:function(){this.getTimeSlots()}},{key:"getTimeSlots",value:function(){var e=f(regeneratorRuntime.mark(function e(){var t;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.getRequest(c.default+"/timeslots");case 2:if(t=e.sent,this.state.timeSlotsUpdated){e.next=6;break}return e.next=6,this.clearPassedTimeSlots(t);case 6:this.setState({timeSlots:t}),this.forceUpdate();case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"clearPassedTimeSlots",value:function(){var e=f(regeneratorRuntime.mark(function e(t){var n=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,r){for(var o=[],a=0;a<t.length;a++){new Date(t[a].dateTimeISO)-new Date<0?n.removeTimeSlot(t[a]._id):o.push(t[a])}n.setState({timeSlotsUpdated:!0}),e(o)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"updateTimeSlot",value:function(){var e=f(regeneratorRuntime.mark(function e(t,n){var r,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r={client:n?n.displayName:"",clientMail:n?n.mail:""},e.next=3,s.default.postRequest(c.default+"/timeslots/"+t,r);case 3:if(void 0===(o=e.sent).name){e.next=9;break}if(null===n){e.next=8;break}return e.next=8,this.createCalendarEvent(this.props.accessToken,o,n);case 8:this.getTimeSlots();case 9:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"addTimeSlot",value:function(){var e=f(regeneratorRuntime.mark(function e(t,n){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(""===t||!i.default.isMoment(n)){e.next=5;break}return r={name:t,dateFormatted:n.format("DD/MM HH:mm"),dateTimeISO:n.toISOString()},e.next=4,s.default.postRequest(c.default+"/timeslots",r,!1);case 4:this.getTimeSlots();case 5:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"removeTimeSlot",value:function(){var e=f(regeneratorRuntime.mark(function e(t){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.default.deleteRequest(c.default+"/timeslots/"+t);case 2:this.getTimeSlots();case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"createCalendarEvent",value:function(){var e=f(regeneratorRuntime.mark(function e(t,n,r){var o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o={subject:"Massage hos "+n.name,start:{dateTime:n.dateTimeISO,timeZone:"W. Europe Standard Time"},end:{dateTime:n.dateTimeISO,timeZone:"W. Europe Standard Time"},reminderMinutesBeforeStart:60,attendees:[{emailAddress:{address:r.mail,name:r.displayName},type:"required"}]},e.next=3,s.default.postRequest("https://graph.microsoft.com/beta/me/events",o,!0,t);case 3:case"end":return e.stop()}},e,this)}));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this,t=[],n=[];return this.state.timeSlots.map(function(o){""!==o.client?n.push((0,a.h)(u.TimeSlot,r({},o,{user:e.props.user,updateTimeSlot:function(t,n){return e.updateTimeSlot(t,n)},removeTimeSlot:function(t){return e.removeTimeSlot(t)},admin:e.props.admin}))):t.push((0,a.h)(u.TimeSlot,r({},o,{user:e.props.user,updateTimeSlot:function(t,n){return e.updateTimeSlot(t,n)},removeTimeSlot:function(t){return e.removeTimeSlot(t)},admin:e.props.admin})))}),(0,a.h)("div",{className:"time-slots-manager"},(0,a.h)("div",{className:"time-slots-manager__list "+(n.length?"":"time-slots-manager__list--single")},(0,a.h)("div",{className:"time-slots-manager__list-col"},t.map(function(e){return e})),n.length>0&&(0,a.h)("div",{className:"time-slots-manager__list-col"},n.map(function(e){return e}))),this.props.admin&&(0,a.h)("div",{class:"time-slots-manager__add"},(0,a.h)("h2",{class:"time-slots-manager__subtitle"},"Lägg till en tid"),(0,a.h)(u.AddTimeSlot,{addTimeSlot:function(t,n){return e.addTimeSlot(t,n)}})))}}]),t}();t.default=p},351:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(8),a=u(n(352));n(358);var i=u(n(55));function u(e){return e&&e.__esModule?e:{default:e}}n(359);var s=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={name:"",momentDate:null},e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"componentDidMount",value:function(){i.default.locale("sv")}},{key:"setDateTime",value:function(e){i.default.isMoment(e)&&this.setState({momentDate:e})}},{key:"addTimeSlot",value:function(){var e=this.state,t=e.name,n=e.momentDate;""!==t&&null!==n&&this.props.addTimeSlot(t,n)}},{key:"render",value:function(){var e=this;return(0,o.h)("div",{class:"add-time-slot"},(0,o.h)("div",{class:"add-time-slot__slots"},(0,o.h)("div",{class:"add-time-slot__input-wrapper"},(0,o.h)("label",{class:"add-time-slot__label",htmlFor:"name"},"Massör"),(0,o.h)("input",{class:"add-time-slot__input",type:"text",name:"name",id:"name",ref:function(t){e.nameInput=t},onChange:function(t){return e.setState({name:t.target.value})}})),(0,o.h)("div",{class:"add-time-slot__input-wrapper"},(0,o.h)("label",{class:"add-time-slot__label",htmlFor:"time"},"Tid"),(0,o.h)(a.default,{class:"add-time-slot__rdt",timeFormat:"HH:mm",onChange:function(t){return e.setDateTime(t)}}))),(0,o.h)("button",{class:"button",onClick:function(){return e.addTimeSlot()}},"Lägg till"))}}]),t}();t.default=s},360:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();n(98);var o=n(8),a=n(99);var i=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:"render",value:function(){return(0,o.h)("div",{class:"main"},(0,o.h)("h2",{class:"main__subtitle"},"Tider"),(0,o.h)(a.TimeSlotsManager,{admin:!0}))}}]),t}();t.default=i},361:function(e,t){},99:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddTimeSlot=t.TimeSlotsManager=t.TimeSlot=void 0;var r=i(n(348)),o=i(n(349)),a=i(n(351));function i(e){return e&&e.__esModule?e:{default:e}}t.TimeSlot=r.default,t.TimeSlotsManager=o.default,t.AddTimeSlot=a.default}});
//# sourceMappingURL=bundle.js.map